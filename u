[33mcommit b24131fe326ca72143af0383e5d27c2124d9f53b[m[33m ([m[1;36mHEAD[m[33m -> [m[1;32mmain[m[33m, [m[1;31morigin/main[m[33m)[m
Author: Rudra <rudrasoni273@gmail.com>
Date:   Tue Nov 25 19:37:12 2025 +0530

    added Pause Menu and egg breaking mechanism

[1mdiff --git a/scenes/egg.tscn b/scenes/egg.tscn[m
[1mindex 46daa3d..0b5d966 100644[m
[1m--- a/scenes/egg.tscn[m
[1m+++ b/scenes/egg.tscn[m
[36m@@ -1,12 +1,15 @@[m
[31m-[gd_scene load_steps=3 format=3 uid="uid://b3eufrdqb7hba"][m
[32m+[m[32m[gd_scene load_steps=4 format=3 uid="uid://b3eufrdqb7hba"][m
 [m
 [ext_resource type="Texture2D" uid="uid://ddjd5nmgbu2g2" path="res://assets/egg.png" id="1_maxla"][m
[32m+[m[32m[ext_resource type="Script" uid="uid://dnv1r6nrwh7s8" path="res://scripts/egg.gd" id="1_qlus4"][m
 [m
 [sub_resource type="RectangleShape2D" id="RectangleShape2D_maxla"][m
[31m-size = Vector2(8, 10)[m
[32m+[m[32msize = Vector2(9, 12)[m
 [m
 [node name="egg" type="RigidBody2D"][m
[31m-collision_layer = 3[m
[32m+[m[32mcontact_monitor = true[m
[32m+[m[32mmax_contacts_reported = 8[m
[32m+[m[32mscript = ExtResource("1_qlus4")[m
 [m
 [node name="Sprite2D" type="Sprite2D" parent="."][m
 position = Vector2(0, -1)[m
[36m@@ -14,4 +17,5 @@[m [mscale = Vector2(0.9, 0.9)[m
 texture = ExtResource("1_maxla")[m
 [m
 [node name="CollisionShape2D" type="CollisionShape2D" parent="."][m
[32m+[m[32mposition = Vector2(0.5, 0)[m
 shape = SubResource("RectangleShape2D_maxla")[m
[1mdiff --git a/scenes/hud.tscn b/scenes/hud.tscn[m
[1mindex 9618e65..8e2bc58 100644[m
[1m--- a/scenes/hud.tscn[m
[1m+++ b/scenes/hud.tscn[m
[36m@@ -5,6 +5,7 @@[m
 [ext_resource type="Texture2D" uid="uid://d1cr7t5hkgdw8" path="res://assets/Pause.png" id="3_5ysmq"][m
 [m
 [node name="HUD" type="CanvasLayer"][m
[32m+[m[32mprocess_mode = 3[m
 script = ExtResource("1_oo0fn")[m
 egg_icon = ExtResource("2_oo0fn")[m
 [m
[36m@@ -24,7 +25,47 @@[m [moffset_top = 15.0[m
 offset_right = -19.0[m
 offset_bottom = 63.0[m
 grow_horizontal = 0[m
[32m+[m[32mfocus_mode = 0[m
 texture_normal = ExtResource("3_5ysmq")[m
 stretch_mode = 0[m
 [m
[32m+[m[32m[node name="PauseMenu" type="ColorRect" parent="."][m
[32m+[m[32mvisible = false[m
[32m+[m[32manchors_preset = 15[m
[32m+[m[32manchor_right = 1.0[m
[32m+[m[32manchor_bottom = 1.0[m
[32m+[m[32mgrow_horizontal = 2[m
[32m+[m[32mgrow_vertical = 2[m
[32m+[m[32mcolor = Color(0, 0, 0, 0.568627)[m
[32m+[m
[32m+[m[32m[node name="VBoxContainer" type="VBoxContainer" parent="PauseMenu"][m
[32m+[m[32mlayout_mode = 1[m
[32m+[m[32manchors_preset = 8[m
[32m+[m[32manchor_left = 0.5[m
[32m+[m[32manchor_top = 0.5[m
[32m+[m[32manchor_right = 0.5[m
[32m+[m[32manchor_bottom = 0.5[m
[32m+[m[32moffset_left = -54.5[m
[32m+[m[32moffset_top = -62.5[m
[32m+[m[32moffset_right = 54.5[m
[32m+[m[32moffset_bottom = 62.5[m
[32m+[m[32mgrow_horizontal = 2[m
[32m+[m[32mgrow_vertical = 2[m
[32m+[m[32mtheme_override_constants/separation = 16[m
[32m+[m
[32m+[m[32m[node name="ResumeButton" type="Button" parent="PauseMenu/VBoxContainer"][m
[32m+[m[32mlayout_mode = 2[m
[32m+[m[32mtext = "Resume"[m
[32m+[m
[32m+[m[32m[node name="RestartButton" type="Button" parent="PauseMenu/VBoxContainer"][m
[32m+[m[32mlayout_mode = 2[m
[32m+[m[32mtext = "Restart Level"[m
[32m+[m
[32m+[m[32m[node name="QuiteButton" type="Button" parent="PauseMenu/VBoxContainer"][m
[32m+[m[32mlayout_mode = 2[m
[32m+[m[32mtext = "Quit"[m
[32m+[m
 [connection signal="pressed" from="PauseButton" to="." method="_on_pause_button_pressed"][m
[32m+[m[32m[connection signal="pressed" from="PauseMenu/VBoxContainer/ResumeButton" to="." method="_on_resume_button_pressed"][m
[32m+[m[32m[connection signal="pressed" from="PauseMenu/VBoxContainer/RestartButton" to="." method="_on_restart_button_pressed"][m
[32m+[m[32m[connection signal="pressed" from="PauseMenu/VBoxContainer/QuiteButton" to="." method="_on_quite_button_pressed"][m
[1mdiff --git a/scripts/egg.gd b/scripts/egg.gd[m
[1mindex e8514b7..5726996 100644[m
[1m--- a/scripts/egg.gd[m
[1m+++ b/scripts/egg.gd[m
[36m@@ -2,38 +2,89 @@[m [mextends RigidBody2D[m
 [m
 var used := false[m
 signal egg_broken[m
[32m+[m[32msignal egg_landed[m
[32m+[m
[32m+[m[32m@export var break_velocity_threshold: float = 250.0[m
 [m
 @onready var shape: CollisionShape2D = $CollisionShape2D[m
 [m
[32m+[m[32mvar last_velocity := Vector2.ZERO[m
[32m+[m
[32m+[m[32m# These MUST exist so the Player can assign them[m
[32m+[m[32mvar was_finalized := false   # true once the egg has landed or broken[m
[32m+[m[32mvar broke := false           # true if egg broke on landing[m
[32m+[m
 [m
 func _ready():[m
[32m+[m	[32mcontact_monitor = true[m
[32m+[m	[32mmax_contacts_reported = 8[m
 	freeze = false[m
 [m
[32m+[m	[32mconnect("body_shape_entered", _on_body_entered)[m
[32m+[m
[32m+[m
[32m+[m[32mfunc _physics_process(_delta):[m
[32m+[m	[32mlast_velocity = linear_velocity[m
[32m+[m
[32m+[m
[32m+[m[32mfunc _on_body_entered(_rid, _body, _body_shape, _local_shape):[m
[32m+[m	[32mif was_finalized:[m
[32m+[m		[32mreturn[m
[32m+[m
[32m+[m	[32mwas_finalized = true[m
[32m+[m
[32m+[m	[32mvar impact_speed = abs(last_velocity.y)[m
[32m+[m	[32mprint("Egg impact:", impact_speed)[m
[32m+[m
[32m+[m	[32mif impact_speed > break_velocity_threshold:[m
[32m+[m		[32mbroke = true[m
[32m+[m		[32mbreak_egg()[m
[32m+[m	[32melse:[m
[32m+[m		[32mbroke = false[m
[32m+[m		[32mland_egg()[m
[32m+[m
[32m+[m
[32m+[m[32mfunc land_egg():[m
[32m+[m	[32mif used:[m
[32m+[m		[32mreturn[m
[32m+[m
[32m+[m	[32mprint("âœ¨ Egg survived landing")[m
[32m+[m
[32m+[m	[32m# Freeze in place[m
[32m+[m	[32mfreeze = true[m
[32m+[m	[32mfreeze_mode = RigidBody2D.FREEZE_MODE_KINEMATIC[m
[32m+[m	[32msleeping = true[m
[32m+[m	[32mlinear_velocity = Vector2.ZERO[m
[32m+[m	[32mangular_velocity = 0[m
[32m+[m
[32m+[m	[32memit_signal("egg_landed", self)[m
[32m+[m
 [m
 func mark_as_checkpoint():[m
 	if not used:[m
[31m-		modulate = Color(1, 1, 0.5)  # highlight[m
[32m+[m		[32mmodulate = Color(1, 1, 0.5)[m
 [m
 [m
 func break_egg():[m
 	if used:[m
 		return[m
[32m+[m
 	used = true[m
 	print("ðŸ’¥ Egg breaking...")[m
 [m
[31m-	# Disable collisions[m
 	if shape:[m
 		shape.disabled = true[m
[32m+[m
 	collision_layer = 0[m
 	collision_mask = 0[m
 [m
[31m-	# Stop physics[m
[32m+[m	[32m# Freeze physics[m
 	freeze = true[m
 	freeze_mode = RigidBody2D.FREEZE_MODE_KINEMATIC[m
 	sleeping = true[m
 [m
[31m-	# Visual change[m
 	modulate = Color(0.6, 0.6, 0.6, 0.5)[m
 [m
[31m-	emit_signal("egg_broken")[m
[31m-	queue_free()[m
[32m+[m	[32memit_signal("egg_broken", self)[m
[32m+[m
[32m+[m	[32mcall_deferred("queue_free")[m
[1mdiff --git a/scripts/hud.gd b/scripts/hud.gd[m
[1mindex fdd9c70..c0ab187 100644[m
[1m--- a/scripts/hud.gd[m
[1m+++ b/scripts/hud.gd[m
[36m@@ -1,8 +1,10 @@[m
 extends CanvasLayer[m
 [m
[31m-@export var egg_icon: Texture2D      # assign your egg sprite in the inspector[m
[31m-@onready var egg_container: HBoxContainer = $EggContainer[m
[32m+[m[32m@export var egg_icon: Texture2D[m
 [m
[32m+[m[32m@onready var egg_container: HBoxContainer = $EggContainer[m
[32m+[m[32m@onready var pause_menu: ColorRect = $PauseMenu[m
[32m+[m[32m@onready var pause_button := $PauseButton[m
 [m
 func update_eggs_remaining(remaining: int):[m
 	# Remove old icons[m
[36m@@ -10,7 +12,7 @@[m [mfunc update_eggs_remaining(remaining: int):[m
 		egg_container.remove_child(child)[m
 		child.queue_free()[m
 [m
[31m-	# Add icons for remaining eggs[m
[32m+[m	[32m# Add icons[m
 	for i in range(remaining):[m
 		var icon = TextureRect.new()[m
 		icon.texture = egg_icon[m
[36m@@ -19,10 +21,26 @@[m [mfunc update_eggs_remaining(remaining: int):[m
 		egg_container.add_child(icon)[m
 [m
 [m
[31m-func _on_pause_pressed():[m
[31m-	get_tree().paused = not get_tree().paused[m
[32m+[m[32mfunc _on_pause_button_pressed():[m
[32m+[m	[32mtoggle_pause()[m
 [m
 [m
[31m-func _on_pause_button_pressed() -> void:[m
[32m+[m[32mfunc toggle_pause():[m
 	get_tree().paused = not get_tree().paused[m
[31m-	print("Pause toggled:", get_tree().paused)[m
[32m+[m	[32mpause_menu.visible = get_tree().paused   # show/hide menu[m
[32m+[m	[32mprint("Paused:", get_tree().paused)[m
[32m+[m
[32m+[m
[32m+[m[32m# Resume Button[m
[32m+[m[32mfunc _on_resume_button_pressed():[m
[32m+[m	[32mget_tree().paused = false[m
[32m+[m	[32mpause_menu.visible = false[m
[32m+[m
[32m+[m
[32m+[m[32m# Restart Button[m
[32m+[m[32mfunc _on_restart_button_pressed():[m
[32m+[m	[32mget_tree().paused = false[m
[32m+[m	[32mget_tree().reload_current_scene()[m
[32m+[m
[32m+[m[32mfunc _on_quite_button_pressed() -> void:[m
[32m+[m	[32mget_tree().quit()[m
[1mdiff --git a/scripts/player.gd b/scripts/player.gd[m
[1mindex 6314bc8..d14a056 100644[m
[1m--- a/scripts/player.gd[m
[1m+++ b/scripts/player.gd[m
[36m@@ -12,8 +12,8 @@[m [mextends CharacterBody2D[m
 @export var egg_scene: PackedScene[m
 @export var max_eggs_per_level := 3[m
 [m
[31m-var eggs_used := 0              # how many eggs the player has dropped[m
[31m-var egg_stack: Array = []       # stores egg instances placed[m
[32m+[m[32mvar eggs_used := 0[m
[32m+[m[32mvar egg_stack: Array = [][m
 [m
 # --- Animation ---[m
 @export var idle_anim_name := "idle"[m
[36m@@ -25,19 +25,17 @@[m [mvar air_time := 0.0[m
 @onready var anim: AnimatedSprite2D = $AnimatedSprite2D[m
 [m
 var spawn_point: Vector2[m
[31m-var drifting: bool = false[m
[32m+[m[32mvar drifting := false[m
 [m
[31m-var hud: Node = null     # <------ HUD reference[m
[32m+[m[32mvar hud: Node = null[m
 [m
 [m
 func _ready() -> void:[m
 	spawn_point = global_position[m
 [m
[31m-	# Get HUD from level scene[m
 	hud = get_tree().current_scene.get_node("HUD")[m
 	hud.update_eggs_remaining(max_eggs_per_level - eggs_used)[m
 [m
[31m-	# Initial animation state[m
 	if is_on_floor():[m
 		anim.play(idle_anim_name)[m
 	else:[m
[36m@@ -47,7 +45,7 @@[m [mfunc _ready() -> void:[m
 func _physics_process(delta: float) -> void:[m
 	velocity.y += gravity * delta[m
 [m
[31m-	var direction = Input.get_axis("move_left", "move_right")[m
[32m+[m	[32mvar direction := Input.get_axis("move_left", "move_right")[m
 [m
 	if direction != 0:[m
 		drifting = false[m
[36m@@ -94,33 +92,37 @@[m [mfunc _input(event):[m
 		die()[m
 [m
 [m
[32m+[m[32m####################################################[m
[32m+[m[32m###           DROP EGG (unchanged)               ###[m
[32m+[m[32m####################################################[m
[32m+[m
 func drop_egg():[m
 	if eggs_used >= max_eggs_per_level:[m
 		print("âš ï¸ No eggs remaining for this level.")[m
 		return[m
 [m
[31m-	if egg_scene == null:[m
[31m-		print("âŒ Egg scene not assigned!")[m
[31m-		return[m
[31m-[m
 	var egg = egg_scene.instantiate()[m
 	egg.global_position = global_position + Vector2(0, 16)[m
 	get_parent().add_child(egg)[m
 [m
[32m+[m	[32m# Connect signals IMMEDIATELY (important!)[m
[32m+[m	[32megg.egg_landed.connect(_on_egg_landed)[m
[32m+[m	[32megg.egg_broken.connect(_on_egg_broken)[m
[32m+[m
 	egg_stack.append(egg)[m
 	eggs_used += 1[m
 [m
 	spawn_point = egg.global_position[m
 [m
[31m-	if egg.has_method("mark_as_checkpoint"):[m
[31m-		egg.mark_as_checkpoint()[m
[31m-[m
 	print("ðŸ¥š Egg placed:", eggs_used, "/", max_eggs_per_level)[m
 [m
[31m-	# HUD update[m
 	hud.update_eggs_remaining(max_eggs_per_level - eggs_used)[m
 [m
 [m
[32m+[m[32m####################################################[m
[32m+[m[32m###               DEATH LOGIC                    ###[m
[32m+[m[32m####################################################[m
[32m+[m
 func die() -> void:[m
 	print("ðŸ’€ Player crashed!")[m
 [m
[36m@@ -128,27 +130,53 @@[m [mfunc die() -> void:[m
 		var last_egg = egg_stack.back()[m
 		egg_stack.erase(last_egg)[m
 [m
[31m-		if last_egg.has_signal("egg_broken"):[m
[31m-			last_egg.egg_broken.connect(_on_egg_broken.bind(last_egg))[m
[31m-			last_egg.break_egg()[m
[32m+[m		[32m# If the egg broke from landing[m
[32m+[m		[32mif last_egg.was_finalized and last_egg.broke:[m
[32m+[m			[32m# Egg already emitted egg_broken, spawn point already handled[m
[32m+[m			[32mrespawn_at_spawn_point()[m
[32m+[m
[32m+[m		[32m# If egg survived landing (normal checkpoint)[m
 		else:[m
 			spawn_point = last_egg.global_position[m
 			last_egg.queue_free()[m
 			respawn_at_spawn_point()[m
[32m+[m
 	else:[m
 		print("ðŸš¨ All eggs used â€” restarting from beginning.")[m
 		get_tree().reload_current_scene()[m
 [m
 [m
[32m+[m[32m####################################################[m
[32m+[m[32m###          EGG SIGNAL HANDLERS                ###[m
[32m+[m[32m####################################################[m
[32m+[m
[32m+[m[32mfunc _on_egg_landed(egg):[m
[32m+[m	[32m# Egg survived impact -> usable checkpoint[m
[32m+[m	[32megg.was_finalized = true[m
[32m+[m	[32megg.broke = false[m
[32m+[m	[32mprint("âœ¨ Egg survived landing")[m
[32m+[m
[32m+[m
 func _on_egg_broken(egg):[m
[31m-	spawn_point = egg.global_position[m
[31m-	respawn_at_spawn_point()[m
[32m+[m	[32megg.was_finalized = true[m
[32m+[m	[32megg.broke = true[m
[32m+[m	[32mprint("ðŸ’¥ Egg broke on landing")[m
 [m
[31m-	hud.update_eggs_remaining(max_eggs_per_level - eggs_used)[m
[32m+[m	[32m# Remove broken egg from stack[m
[32m+[m	[32megg_stack.erase(egg)[m
[32m+[m
[32m+[m	[32m# Broken eggs DO NOT update spawn point (player should respawn at previous egg)[m
 [m
[31m-	print("ðŸ•Šï¸ Respawned. Eggs left:", max_eggs_per_level - eggs_used)[m
 [m
[32m+[m[32m####################################################[m
[32m+[m[32m###                RESPAWN LOGIC                 ###[m
[32m+[m[32m####################################################[m
 [m
 func respawn_at_spawn_point():[m
 	global_position = spawn_point[m
 	velocity = Vector2.ZERO[m
[32m+[m
[32m+[m
[32m+[m[32m# fallback remap implementation[m
[32m+[m[32mfunc remap(value, in_min, in_max, out_min, out_max) -> float:[m
[32m+[m	[32mreturn lerp(out_min, out_max, (value - in_min) / (in_max - in_min))[m
